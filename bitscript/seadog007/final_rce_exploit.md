# Final RCE Exploit Plan

## ✅ What We Have

**Addresses:**
- `printf@GOT`: 0x409048 (target for overwrite)
- `printf@PLT`: 0x4011f0
- `puts@GOT`: 0x409038 (alternative target)
- `puts@PLT`: 0x4011d0

**ROP Gadgets:**
- `pop rdi ; ret`: 0x404f4d
- `pop rsi ; pop r15 ; ret`: 0x405711
- `ret`: 0x40101a

**Binary:**
- No PIE (0x400000 base)
- Partial RELRO (GOT writable)
- No stack canary

## ❓ Missing: system() Function

**Problem:** `system()` doesn't appear to be imported in the binary.

**Solutions:**

### Option 1: Use execve via ROP
- Need execve address (check libc)
- Build ROP chain: pop rdi + "/bin/sh" + pop rsi + NULL + pop rdx + NULL + execve

### Option 2: Find system in libc
- If libc is loaded, system@libc might be at known offset
- Calculate: libc_base + system_offset

### Option 3: Use one_gadget
- If libc available, use one_gadget for instant RCE
- Requires specific register conditions

### Option 4: Corrupt Function Pointer
- Instead of GOT, corrupt a function pointer in heap
- Point to ROP chain or system

## Exploitation Strategy

### The Key Challenge

**Heap overflow writes to heap, but:**
- GOT is at 0x409048 (different region)
- Stack is separate
- We need a **write primitive** from heap

### Solution: Variable Assignment Write Primitive

**Idea:** Corrupt a variable's value pointer, then use assignment to write!

1. **Heap groom:** Place variable entry near overflow
2. **Overflow:** Corrupt variable entry's `value_ptr` (offset 0x28)
3. **Set value_ptr:** Point to `printf@GOT` (0x409048)
4. **Assignment:** `variable = value` writes to `value_ptr`
5. **Write system address:** Assign system address to variable
6. **Trigger:** `print("/bin/sh")` → calls system

### Alternative: String/Bitmap Write Primitive

**If variable assignment doesn't work:**
- Corrupt string structure's data pointer
- Use `replace()` to write to GOT
- Or corrupt bitmap data pointer, use `set()` to write

## Next Steps

1. **Find system/execve:**
   ```bash
   ldd ./bitscript
   one_gadget /lib/x86_64-linux-gnu/libc.so.6
   ```

2. **Test variable corruption:**
   - Groom heap to place variable near overflow
   - Corrupt value_ptr to point to GOT
   - Try assignment to write

3. **Craft final payload:**
   - Build strings for overflow
   - Corrupt target pointer
   - Write system address
   - Trigger execution

